

.. _example_connectivity_plot_multi_subject_connectome.py:


Group Sparse inverse covariance for multi-subject connectome
=============================================================

This example shows how to estimate a connectome on a groupe of subjects
using the group sparse inverse covariance estimate.




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: images/plot_multi_subject_connectome_001.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_002.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_003.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_004.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_005.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_006.png
            :scale: 47

    *

      .. image:: images/plot_multi_subject_connectome_007.png
            :scale: 47


**Script output**:

.. rst-class:: sphx-glr-script-out

  ::

    -- Fetching datasets ...
    First subject functional nifti image (4D) is at: /storage/data/nilearn_data/adhd/data/3902469/3902469_rest_tshift_RPI_voreg_mni.nii.gz
    [NiftiMapsMasker.fit] loading regions from /storage/data/nilearn_data/msdl_atlas/MSDL_rois/msdl_rois.nii
    Processing file /storage/data/nilearn_data/adhd/data/3902469/3902469_rest_tshift_RPI_voreg_mni.nii.gz
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.image.high_variance_confounds...
    high_variance_confounds('/storage/data/nilearn_data/adhd/data/3902469/3902469_rest_tshift_RPI_voreg_mni.nii.gz')
    __________________________________________high_variance_confounds - 4.6s, 0.1min
    [NiftiMapsMasker.transform] loading images from /storage/data/nilearn_data/adhd/data/3902469/3902469_rest_tshift_RPI_voreg_mni.nii.gz
    [NiftiMapsMasker.transform] resampling images to fit maps
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.resampling.resample_img...
    resample_img(<nibabel.nifti1.Nifti1Image object at 0x2b77d58b7750>, target_shape=(40, 48, 35), target_affine=array([[   4.,    0.,    0.,  -78.],
           [   0.,    4.,    0., -111.],
           [   0.,    0.,    4.,  -51.],
           [   0.,    0.,    0.,    1.]]), interpolation='continuous')
    ____________________________________________________resample_img - 11.8s, 0.2min
    [NiftiMapsMasker.transform] extracting region signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.region.img_to_signals_maps...
    img_to_signals_maps(<nibabel.nifti1.Nifti1Image object at 0x2b77d58b7050>, <nibabel.nifti1.Nifti1Image object at 0x2b77d58b7d10>, mask_img=None)
    ______________________________________________img_to_signals_maps - 4.1s, 0.1min
    [NiftiMapsMasker.transform] cleaning extracted signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.signal.clean...
    clean(array([[ 34908.223397, ...,  37109.330878],
           ..., 
           [ 34617.494793, ...,  37014.006541]]), standardize=True, detrend=True, confounds=[array([[-0.006152, ..., -0.029163],
           ..., 
           [ 0.001355, ...,  0.168944]], dtype=float32),
    '/storage/data/nilearn_data/adhd/data/3902469/3902469_regressors.csv'], low_pass=None, t_r=2.5, high_pass=0.01)
    ____________________________________________________________clean - 0.1s, 0.0min
    Processing file /storage/data/nilearn_data/adhd/data/7774305/7774305_rest_tshift_RPI_voreg_mni.nii.gz
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.image.high_variance_confounds...
    high_variance_confounds('/storage/data/nilearn_data/adhd/data/7774305/7774305_rest_tshift_RPI_voreg_mni.nii.gz')
    __________________________________________high_variance_confounds - 4.8s, 0.1min
    [NiftiMapsMasker.transform] loading images from /storage/data/nilearn_data/adhd/data/7774305/7774305_rest_tshift_RPI_voreg_mni.nii.gz
    [NiftiMapsMasker.transform] resampling images to fit maps
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.resampling.resample_img...
    resample_img(<nibabel.nifti1.Nifti1Image object at 0x2b77ccdd53d0>, target_shape=(40, 48, 35), target_affine=array([[   4.,    0.,    0.,  -78.],
           [   0.,    4.,    0., -111.],
           [   0.,    0.,    4.,  -51.],
           [   0.,    0.,    0.,    1.]]), interpolation='continuous')
    ____________________________________________________resample_img - 13.4s, 0.2min
    [NiftiMapsMasker.transform] extracting region signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.region.img_to_signals_maps...
    img_to_signals_maps(<nibabel.nifti1.Nifti1Image object at 0x2b77ccdd5c90>, <nibabel.nifti1.Nifti1Image object at 0x2b77d58b7d10>, mask_img=None)
    ______________________________________________img_to_signals_maps - 3.9s, 0.1min
    [NiftiMapsMasker.transform] cleaning extracted signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.signal.clean...
    clean(array([[ 40276.638207, ...,  33296.387838],
           ..., 
           [ 40423.660335, ...,  33556.867871]]), standardize=True, detrend=True, confounds=[array([[-0.03608 , ...,  0.070562],
           ..., 
           [-0.055545, ...,  0.218527]], dtype=float32),
    '/storage/data/nilearn_data/adhd/data/7774305/7774305_regressors.csv'], low_pass=None, t_r=2.5, high_pass=0.01)
    ____________________________________________________________clean - 0.1s, 0.0min
    Processing file /storage/data/nilearn_data/adhd/data/3699991/3699991_rest_tshift_RPI_voreg_mni.nii.gz
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.image.high_variance_confounds...
    high_variance_confounds('/storage/data/nilearn_data/adhd/data/3699991/3699991_rest_tshift_RPI_voreg_mni.nii.gz')
    __________________________________________high_variance_confounds - 6.3s, 0.1min
    [NiftiMapsMasker.transform] loading images from /storage/data/nilearn_data/adhd/data/3699991/3699991_rest_tshift_RPI_voreg_mni.nii.gz
    [NiftiMapsMasker.transform] resampling images to fit maps
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.resampling.resample_img...
    resample_img(<nibabel.nifti1.Nifti1Image object at 0x2b77da5c5b10>, target_shape=(40, 48, 35), target_affine=array([[   4.,    0.,    0.,  -78.],
           [   0.,    4.,    0., -111.],
           [   0.,    0.,    4.,  -51.],
           [   0.,    0.,    0.,    1.]]), interpolation='continuous')
    ____________________________________________________resample_img - 12.9s, 0.2min
    [NiftiMapsMasker.transform] extracting region signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.region.img_to_signals_maps...
    img_to_signals_maps(<nibabel.nifti1.Nifti1Image object at 0x2b77da5c5090>, <nibabel.nifti1.Nifti1Image object at 0x2b77d58b7d10>, mask_img=None)
    ______________________________________________img_to_signals_maps - 4.3s, 0.1min
    [NiftiMapsMasker.transform] cleaning extracted signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.signal.clean...
    clean(array([[ 32966.651991, ...,  35921.152155],
           ..., 
           [ 33244.229553, ...,  35981.748685]]), standardize=True, detrend=True, confounds=[array([[ 0.015792, ...,  0.01485 ],
           ..., 
           [ 0.040049, ..., -0.196962]], dtype=float32),
    '/storage/data/nilearn_data/adhd/data/3699991/3699991_regressors.csv'], low_pass=None, t_r=2.5, high_pass=0.01)
    ____________________________________________________________clean - 0.1s, 0.0min
    Processing file /storage/data/nilearn_data/adhd/data/2014113/2014113_rest_tshift_RPI_voreg_mni.nii.gz
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.image.high_variance_confounds...
    high_variance_confounds('/storage/data/nilearn_data/adhd/data/2014113/2014113_rest_tshift_RPI_voreg_mni.nii.gz')
    __________________________________________high_variance_confounds - 4.7s, 0.1min
    [NiftiMapsMasker.transform] loading images from /storage/data/nilearn_data/adhd/data/2014113/2014113_rest_tshift_RPI_voreg_mni.nii.gz
    [NiftiMapsMasker.transform] resampling images to fit maps
    ________________________________________________________________________________
    [Memory] Calling nilearn.image.resampling.resample_img...
    resample_img(<nibabel.nifti1.Nifti1Image object at 0x2b77dae055d0>, target_shape=(40, 48, 35), target_affine=array([[   4.,    0.,    0.,  -78.],
           [   0.,    4.,    0., -111.],
           [   0.,    0.,    4.,  -51.],
           [   0.,    0.,    0.,    1.]]), interpolation='continuous')
    _____________________________________________________resample_img - 9.9s, 0.2min
    [NiftiMapsMasker.transform] extracting region signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.region.img_to_signals_maps...
    img_to_signals_maps(<nibabel.nifti1.Nifti1Image object at 0x2b77dae059d0>, <nibabel.nifti1.Nifti1Image object at 0x2b77d58b7d10>, mask_img=None)
    ______________________________________________img_to_signals_maps - 2.4s, 0.0min
    [NiftiMapsMasker.transform] cleaning extracted signals
    ________________________________________________________________________________
    [Memory] Calling nilearn.signal.clean...
    clean(array([[ 35610.23853 , ...,  37314.19748 ],
           ..., 
           [ 35542.814419, ...,  37465.914883]]), standardize=True, detrend=True, confounds=[array([[-0.086987, ...,  0.091636],
           ..., 
           [-0.057032, ...,  0.006904]], dtype=float32),
    '/storage/data/nilearn_data/adhd/data/2014113/2014113_regressors.csv'], low_pass=None, t_r=2.5, high_pass=0.01)
    ____________________________________________________________clean - 0.1s, 0.0min
    -- Computing group-sparse precision matrices ...
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 5
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 1
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 3
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 1
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 5
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] [GroupSparseCovarianceCV] Done refinement  1 out of 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] [GroupSparseCovarianceCV] Done refinement  2 out of 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 3
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 3
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] [GroupSparseCovarianceCV] Done refinement  3 out of 4
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 3
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 3
    [GroupSparseCovarianceCV.fit] Log-likelihood on test set is decreasing. Stopping at iteration 0
    [GroupSparseCovarianceCV.fit] [GroupSparseCovarianceCV] Done refinement  4 out of 4
    [GroupSparseCovarianceCV.fit] Final optimization
    [GroupSparseCovarianceCV.fit] tolerance reached at iteration number 10: 9.992e-04
    -- Computing graph-lasso precision matrices ...
    [GraphLassoCV] Done refinement  1 out of 4:   0s
    [GraphLassoCV] Done refinement  2 out of 4:   1s
    [GraphLassoCV] Done refinement  3 out of 4:   1s
    [GraphLassoCV] Done refinement  4 out of 4:   2s
    [graph_lasso] Iteration   0, cost  1.74e+02, dual gap 1.123e+00
    [graph_lasso] Iteration   1, cost  1.74e+02, dual gap 1.332e-03
    [graph_lasso] Iteration   2, cost  1.74e+02, dual gap 2.418e-04
    [graph_lasso] Iteration   3, cost  1.74e+02, dual gap 4.035e-05


**Python source code:** :download:`plot_multi_subject_connectome.py <plot_multi_subject_connectome.py>`

.. literalinclude:: plot_multi_subject_connectome.py
    :lines: 9-

**Total running time of the example:**  160.64 seconds
( 2 minutes  40.64 seconds)
    