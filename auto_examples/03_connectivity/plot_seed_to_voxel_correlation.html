
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nilearn: Machine learning for NeuroImaging in Python &#8212; Machine learning for NeuroImaging</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5.0a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.4.10. Comparing connectomes on different reference atlases" href="plot_atlas_comparison.html" />
    <link rel="prev" title="8.4.8. Extract signals on spheres from an atlas and plot a connectome" href="plot_sphere_based_connectome.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nilearn, neuroimaging, python, neuroscience, machinelearning">
<script type="text/javascript">
$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var top = 105 + $('.sphinxsidebarwrapper').offset().top - parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0)),
        sections = {},
        i        = 0,
	url	 = document.URL.replace(/#.*$/, ""),
	current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();
	// Lock the table of content to a fixed position once we scroll enough
	if(pos > top){
	    //begin to scroll
	    $('.sphinxsidebarwrapper').css("position", "fixed");
	    $('.sphinxsidebarwrapper').css("top", -105);
	}
	else{
	    //lock it back into place
	    $('.sphinxsidebarwrapper').css("position", "relative");
	    $('.sphinxsidebarwrapper').css("top",0);
	}

	// Highlight the current section
	$('a.internal').removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            }
            if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
        }
        }
	$('a.internal[href$="' + current_section + '"]').addClass('active');
    });

});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../../index.html">
      <img src="../../_static/nilearn-logo.png" alt="Nilearn logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../decoding/plot_haxby_anova_svm.html">SVM</a></big>
    </li>
    <li>
      <small><a href="../../connectivity/parcellating.html">Ward
          clustering</a></small>
    </li>
    <li>
      <a href="../../decoding/searchlight.html">Searchlight</a>
    </li>
    <li>
      <big><a href="../../connectivity/resting_state_networks.html">ICA</a></big>
    </li>
    <li>
      <a href="../../manipulating_images/data_preparation.html">Nifti IO</a>
    </li>
    <li>
      <a href="../../modules/reference.html#module-nilearn.datasets">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nilearn:</h1>
    <h2>Machine learning for Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="plot_atlas_comparison.html" title="8.4.10. Comparing connectomes on different reference atlases"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_sphere_based_connectome.html" title="8.4.8. Extract signals on spheres from an atlas and plot a connectome"
             accesskey="P">previous</a> |</li>
<li><a href="../../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">8. Nilearn usage examples</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.4.9. Producing single subject maps of seed-to-voxel correlation</a><ul>
<li><a class="reference internal" href="#getting-the-data">8.4.9.1. Getting the data</a></li>
<li><a class="reference internal" href="#time-series-extraction">8.4.9.2. Time series extraction</a></li>
<li><a class="reference internal" href="#performing-the-seed-based-correlation-analysis">8.4.9.3. Performing the seed-based correlation analysis</a></li>
<li><a class="reference internal" href="#fisher-z-transformation-and-save-nifti">8.4.9.4. Fisher-z transformation and save nifti</a></li>
<li><a class="reference internal" href="#plotting-the-seed-based-correlation-map">8.4.9.5. Plotting the seed-based correlation map</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_sphere_based_connectome.html"
                        title="previous chapter">8.4.8. Extract signals on spheres from an atlas and plot a connectome</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_atlas_comparison.html"
                        title="next chapter">8.4.10. Comparing connectomes on different reference atlases</a></p>

<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="producing-single-subject-maps-of-seed-to-voxel-correlation">
<span id="sphx-glr-auto-examples-03-connectivity-plot-seed-to-voxel-correlation-py"></span><h1>8.4.9. Producing single subject maps of seed-to-voxel correlation<a class="headerlink" href="#producing-single-subject-maps-of-seed-to-voxel-correlation" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to produce seed-to-voxel correlation maps for a single
subject based on resting-state fMRI scans. These maps depict the temporal
correlation of a <strong>seed region</strong> with the <strong>rest of the brain</strong>.</p>
<p>This example is an advanced one that requires manipulating the data with numpy.
Note the difference between images, that lie in brain space, and the
numpy array, corresponding to the data inside the mask.</p>
<p>See also <a class="reference internal" href="../01_plotting/plot_surf_stat_map.html#sphx-glr-auto-examples-01-plotting-plot-surf-stat-map-py"><span class="std std-ref">for a similar example using cortical surface input data</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># author: Franz Liem</span>
</pre></div>
</div>
<div class="section" id="getting-the-data">
<h2>8.4.9.1. Getting the data<a class="headerlink" href="#getting-the-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># We will work with the first subject of the adhd data set.</span>
<span class="c1"># adhd_dataset.func is a list of filenames. We select the 1st (0-based)</span>
<span class="c1"># subject by indexing with [0]).</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">adhd_dataset</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.datasets.fetch_adhd.html#nilearn.datasets.fetch_adhd" title="View documentation for nilearn.datasets.fetch_adhd"><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_adhd</span></a><span class="p">(</span><span class="n">n_subjects</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">func_filename</span> <span class="o">=</span> <span class="n">adhd_dataset</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">confound_filename</span> <span class="o">=</span> <span class="n">adhd_dataset</span><span class="o">.</span><span class="n">confounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that func_filename and confound_filename are strings pointing to
files on your hard drive.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">func_filename</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">confound_filename</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">varoquau</span><span class="o">/</span><span class="n">nilearn_data</span><span class="o">/</span><span class="n">adhd</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">0010042</span><span class="o">/</span><span class="mi">0010042</span><span class="n">_rest_tshift_RPI_voreg_mni</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">varoquau</span><span class="o">/</span><span class="n">nilearn_data</span><span class="o">/</span><span class="n">adhd</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">0010042</span><span class="o">/</span><span class="mi">0010042</span><span class="n">_regressors</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
</div>
<div class="section" id="time-series-extraction">
<h2>8.4.9.2. Time series extraction<a class="headerlink" href="#time-series-extraction" title="Permalink to this headline">¶</a></h2>
<p>We are going to extract signals from the functional time series in two
steps. First we will extract the mean signal within the <strong>seed region of
interest</strong>. Second, we will extract the <strong>brain-wide voxel-wise time series</strong>.</p>
<p>We will be working with one seed sphere in the Posterior Cingulate Cortex,
considered part of the Default Mode Network.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pcc_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">52</span><span class="p">,</span> <span class="mi">18</span><span class="p">)]</span>
</pre></div>
</div>
<p>We use <a class="reference internal" href="../../modules/generated/nilearn.input_data.NiftiSpheresMasker.html#nilearn.input_data.NiftiSpheresMasker" title="nilearn.input_data.NiftiSpheresMasker"><code class="xref py py-class docutils literal"><span class="pre">nilearn.input_data.NiftiSpheresMasker</span></code></a> to extract the
<strong>time series from the functional imaging within the sphere</strong>. The
sphere is centered at pcc_coords and will have the radius we pass the
NiftiSpheresMasker function (here 8 mm).</p>
<p>The extraction will also detrend, standardize, and bandpass filter the data.
This will create a NiftiSpheresMasker object.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">input_data</span>

<span class="n">seed_masker</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.input_data.NiftiSpheresMasker.html#nilearn.input_data.NiftiSpheresMasker" title="View documentation for nilearn.input_data.NiftiSpheresMasker"><span class="n">input_data</span><span class="o">.</span><span class="n">NiftiSpheresMasker</span></a><span class="p">(</span>
    <span class="n">pcc_coords</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">low_pass</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high_pass</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s1">&#39;nilearn_cache&#39;</span><span class="p">,</span> <span class="n">memory_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we extract the mean time series within the seed region while
regressing out the confounds that
can be found in the dataset’s csv file</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">seed_time_series</span> <span class="o">=</span> <span class="n">seed_masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">func_filename</span><span class="p">,</span>
                                             <span class="n">confounds</span><span class="o">=</span><span class="p">[</span><span class="n">confound_filename</span><span class="p">])</span>
</pre></div>
</div>
<p>Next, we can proceed similarly for the <strong>brain-wide voxel-wise time
series</strong>, using <a class="reference internal" href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="nilearn.input_data.NiftiMasker"><code class="xref py py-class docutils literal"><span class="pre">nilearn.input_data.NiftiMasker</span></code></a> with the same input
arguments as in the seed_masker in addition to smoothing with a 6 mm kernel</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">brain_masker</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.input_data.NiftiMasker.html#nilearn.input_data.NiftiMasker" title="View documentation for nilearn.input_data.NiftiMasker"><span class="n">input_data</span><span class="o">.</span><span class="n">NiftiMasker</span></a><span class="p">(</span>
    <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">low_pass</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high_pass</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="s1">&#39;nilearn_cache&#39;</span><span class="p">,</span> <span class="n">memory_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we extract the brain-wide voxel-wise time series while regressing
out the confounds as before</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">brain_time_series</span> <span class="o">=</span> <span class="n">brain_masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">func_filename</span><span class="p">,</span>
                                               <span class="n">confounds</span><span class="o">=</span><span class="p">[</span><span class="n">confound_filename</span><span class="p">])</span>
</pre></div>
</div>
<p>We can now inspect the extracted time series. Note that the <strong>seed time
series</strong> is an array with shape n_volumes, 1), while the
<strong>brain time series</strong> is an array with shape (n_volumes, n_voxels).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;seed time series shape: (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">seed_time_series</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;brain time series shape: (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">brain_time_series</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">seed</span> <span class="n">time</span> <span class="n">series</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">176</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">brain</span> <span class="n">time</span> <span class="n">series</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">176</span><span class="p">,</span> <span class="mi">69681</span><span class="p">)</span>
</pre></div>
</div>
<p>We can plot the <strong>seed time series</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="View documentation for matplotlib.pyplot.plot"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">seed_time_series</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="View documentation for matplotlib.pyplot.title"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s1">&#39;Seed time series (Posterior cingulate cortex)&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel" title="View documentation for matplotlib.pyplot.xlabel"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span></a><span class="p">(</span><span class="s1">&#39;Scan number&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.ylabel.html#matplotlib.pyplot.ylabel" title="View documentation for matplotlib.pyplot.ylabel"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span></a><span class="p">(</span><span class="s1">&#39;Normalized signal&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/tight_layout_api.html#matplotlib.tight_layout" title="View documentation for matplotlib.pyplot.tight_layout"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_seed_to_voxel_correlation_001.png" class="align-center" src="../../_images/sphx_glr_plot_seed_to_voxel_correlation_001.png" />
<p>Exemplarily, we can also select 5 random voxels from the <strong>brain-wide
data</strong> and plot the time series from.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="View documentation for matplotlib.pyplot.plot"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">brain_time_series</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]])</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="View documentation for matplotlib.pyplot.title"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s1">&#39;Time series from 5 random voxels&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel" title="View documentation for matplotlib.pyplot.xlabel"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span></a><span class="p">(</span><span class="s1">&#39;Scan number&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.ylabel.html#matplotlib.pyplot.ylabel" title="View documentation for matplotlib.pyplot.ylabel"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span></a><span class="p">(</span><span class="s1">&#39;Normalized signal&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/tight_layout_api.html#matplotlib.tight_layout" title="View documentation for matplotlib.pyplot.tight_layout"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_seed_to_voxel_correlation_002.png" class="align-center" src="../../_images/sphx_glr_plot_seed_to_voxel_correlation_002.png" />
</div>
<div class="section" id="performing-the-seed-based-correlation-analysis">
<h2>8.4.9.3. Performing the seed-based correlation analysis<a class="headerlink" href="#performing-the-seed-based-correlation-analysis" title="Permalink to this headline">¶</a></h2>
<p>Now that we have two arrays (<strong>sphere signal</strong>: (n_volumes, 1),
<strong>brain-wide voxel-wise signal</strong> (n_volumes, n_voxels)), we can correlate
the <strong>seed signal</strong> with the <strong>signal of each voxel</strong>. The dot product of
the two arrays will give us this correlation. Note that the signals have
been variance-standardized during extraction. To have them standardized to
norm unit, we further have to divide the result by the length of the time
series.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">seed_based_correlations</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.dot.html#numpy.dot" title="View documentation for numpy.dot"><span class="n">np</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><span class="n">brain_time_series</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">seed_time_series</span><span class="p">)</span> <span class="o">/</span> \
                          <span class="n">seed_time_series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>The resulting array will contain a value representing the correlation
values between the signal in the <strong>seed region</strong> of interest and <strong>each
voxel’s signal</strong>, and will be of shape (n_voxels, 1). The correlation
values can potentially range between -1 and 1.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;seed-based correlation shape: (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">seed_based_correlations</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;seed-based correlation: min = </span><span class="si">%.3f</span><span class="s2">; max = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">seed_based_correlations</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">seed_based_correlations</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">seed</span><span class="o">-</span><span class="n">based</span> <span class="n">correlation</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">69681</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">seed</span><span class="o">-</span><span class="n">based</span> <span class="n">correlation</span><span class="p">:</span> <span class="nb">min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.710</span><span class="p">;</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">0.972</span>
</pre></div>
</div>
</div>
<div class="section" id="fisher-z-transformation-and-save-nifti">
<h2>8.4.9.4. Fisher-z transformation and save nifti<a class="headerlink" href="#fisher-z-transformation-and-save-nifti" title="Permalink to this headline">¶</a></h2>
<p>Now we can Fisher-z transform the data to achieve a normal distribution.
The transformed array can now have values more extreme than +/- 1.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">seed_based_correlations_fisher_z</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.11.0/reference/generated/numpy.arctanh.html#numpy.arctanh" title="View documentation for numpy.arctanh"><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span></a><span class="p">(</span><span class="n">seed_based_correlations</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;seed-based correlation Fisher-z transformed: min = </span><span class="si">%.3f</span><span class="s2">; max = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">seed_based_correlations_fisher_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
    <span class="n">seed_based_correlations_fisher_z</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

<span class="c1"># Finally, we can tranform the correlation array back to a Nifti image</span>
<span class="c1"># object, that we can save.</span>
<span class="n">seed_based_correlation_img</span> <span class="o">=</span> <span class="n">brain_masker</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span>
    <span class="n">seed_based_correlations</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">seed_based_correlation_img</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s1">&#39;sbc_z.nii.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">seed</span><span class="o">-</span><span class="n">based</span> <span class="n">correlation</span> <span class="n">Fisher</span><span class="o">-</span><span class="n">z</span> <span class="n">transformed</span><span class="p">:</span> <span class="nb">min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.887</span><span class="p">;</span> <span class="nb">max</span> <span class="o">=</span> <span class="mf">2.128</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-the-seed-based-correlation-map">
<h2>8.4.9.5. Plotting the seed-based correlation map<a class="headerlink" href="#plotting-the-seed-based-correlation-map" title="Permalink to this headline">¶</a></h2>
<p>We can also plot this image and perform thresholding to only show values
more extreme than +/- 0.3. Furthermore, we can display the location of the
seed with a sphere and set the cross to the center of the seed region of
interest.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>

<span class="n">display</span> <span class="o">=</span> <a href="../../modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">seed_based_correlation_img</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                 <span class="n">cut_coords</span><span class="o">=</span><span class="n">pcc_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">display</span><span class="o">.</span><span class="n">add_markers</span><span class="p">(</span><span class="n">marker_coords</span><span class="o">=</span><span class="n">pcc_coords</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                    <span class="n">marker_size</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="c1"># At last, we save the plot as pdf.</span>
<span class="n">display</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;sbc_z.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_seed_to_voxel_correlation_003.png" class="align-center" src="../../_images/sphx_glr_plot_seed_to_voxel_correlation_003.png" />
<p><strong>Total running time of the script:</strong> ( 0 minutes  17.099 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_seed_to_voxel_correlation.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_seed_to_voxel_correlation.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_seed_to_voxel_correlation.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_seed_to_voxel_correlation.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="plot_atlas_comparison.html" title="8.4.10. Comparing connectomes on different reference atlases"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_sphere_based_connectome.html" title="8.4.8. Extract signals on spheres from an atlas and plot a connectome"
             >previous</a> |</li>
<li><a href="../../index.html">Nilearn Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >8. Nilearn usage examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
            &copy; The nilearn developers 2010-2015.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.7.
        <span style="padding-left: 5ex;">
          <a href="../../_sources/auto_examples/03_connectivity/plot_seed_to_voxel_correlation.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>